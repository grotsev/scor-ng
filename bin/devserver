#!/bin/bash

function killThemAll {
    pkill -f "elm-reactor"
    pkill -f "http_port"
    pkill -f "postgrest-ws"
    pkill -f "postgrest"
    pkill -f "java -jar opt/wiremock-standalone-2.11.0.jar --root-dir build/wiremock --no-request-journal"
}

bin/install
killThemAll

mkdir -p log

bin/wiremock     2>&1 | tee log/wiremock.log     | sed 's/.*/[wiremock] &/' &
sleep 0.2
bin/postgrest    2>&1 | tee log/postgrest.log    | sed 's/.*/[postgrest] &/' &
sleep 0.2
bin/postgrest-ws 2>&1 | tee log/postgrest-ws.log | sed 's/.*/[postgrest-ws] &/' &
sleep 0.2
bin/http_port    2>&1 | tee log/http_port.log    | sed 's/.*/[http_port] &/' &
cd elm
elm-reactor      2>&1 | tee log/elm-reactor.log  | sed 's/.*/[elm-reactor] &/' &
cd ..

sleep 2
read -p $'== Press enter to exit\n'

killThemAll